import { PrismaClient } from '@prisma/client'
import { hashPassword } from '../lib/auth-utils'

const prisma = new PrismaClient()

async function main() {
  console.log('üå± Starting database seeding...')

  // Clear existing data (handle empty database gracefully)
  try {
    await prisma.feedback.deleteMany()
    await prisma.application.deleteMany()
    await prisma.article.deleteMany()
    await prisma.job.deleteMany()
    await prisma.project.deleteMany()
    await prisma.adminUser.deleteMany()
    console.log('üßπ Cleared existing data')
  } catch (error) {
    console.log('‚ÑπÔ∏è Database is empty, proceeding with seeding...')
  }

  // Seed Admin User
  const hashedPassword = await hashPassword('admin123')
  await prisma.adminUser.create({
    data: {
      username: 'admin',
      password: hashedPassword,
      email: 'admin@nobasud.ma',
      name: 'Administrateur NOBASUD',
      active: true
    }
  })

  const projects = await Promise.all([
    prisma.project.create({
      data: {
        name: 'R√©sidence Al Manar',
        slug: 'residence-al-manar',
        type: 'B√¢timent',
        location: 'Casablanca',
        description: 'Complexe r√©sidentiel moderne de 120 appartements avec espaces verts et √©quipements de loisirs. Architecture contemporaine alliant confort et durabilit√©.',
        images: JSON.stringify([
          'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
          'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
        ])
      }
    }),
    prisma.project.create({
      data: {
        name: 'Boulevard Mohammed VI',
        slug: 'boulevard-mohammed-vi',
        type: 'Infrastructure',
        location: 'Marrakech',
        description: 'R√©am√©nagement complet du boulevard principal sur 5 km avec pistes cyclables, √©clairage LED et espaces pi√©tons s√©curis√©s.',
        images: JSON.stringify([
          'https://images.unsplash.com/photo-1586500036706-41963de24d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
        ])
      }
    }),
    prisma.project.create({
      data: {
        name: 'Centre Commercial Atlas',
        slug: 'centre-commercial-atlas',
        type: 'Commercial',
        location: 'Agadir',
        description: 'Centre commercial moderne de 25 000 m¬≤ avec 80 boutiques, hypermarch√© et parking souterrain de 500 places.',
        images: JSON.stringify([
          'https://images.unsplash.com/photo-1555636222-cae831e670b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
        ])
      }
    }),
    prisma.project.create({
      data: {
        name: 'Quartier R√©sidentiel Anfa',
        slug: 'quartier-residentiel-anfa',
        type: 'Am√©nagement',
        location: 'Casablanca',
        description: 'D√©veloppement d\'un nouveau quartier r√©sidentiel avec villas, espaces verts et infrastructures modernes.',
        images: JSON.stringify([
          'https://images.unsplash.com/photo-1448630360428-65456885c650?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
        ])
      }
    }),
    prisma.project.create({
      data: {
        name: 'Pont Hassan II',
        slug: 'pont-hassan-ii',
        type: 'Infrastructure',
        location: 'Rabat',
        description: 'Construction d\'un pont moderne de 800m reliant les deux rives avec architecture innovante et √©clairage artistique.',
        images: JSON.stringify([
          'https://images.unsplash.com/photo-1573160103600-30d74e3fcd14?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
        ])
      }
    })
  ])

  // Seed Articles
  const articles = await Promise.all([
    prisma.article.create({
      data: {
        title: 'NOBASUD remporte le Grand Prix de l\'Innovation BTP 2024',
        slug: 'grand-prix-innovation-btp-2024',
        excerpt: 'Notre entreprise a √©t√© r√©compens√©e pour ses innovations en mati√®re de construction durable.',
        content: `
NOBASUD a √©t√© honor√©e lors de la c√©r√©monie annuelle du Grand Prix de l'Innovation BTP 2024, organis√©e par la F√©d√©ration Marocaine du B√¢timent et des Travaux Publics.

## Une reconnaissance m√©rit√©e

Cette distinction r√©compense nos efforts constants en mati√®re d'innovation et de d√©veloppement durable. Notre approche unique combinant tradition architecturale marocaine et technologies modernes a particuli√®rement s√©duit le jury.

## Nos innovations prim√©es

- **B√©ton √©cologique** : Utilisation de mat√©riaux recycl√©s r√©duisant l'empreinte carbone de 30%
- **Syst√®me de gestion √©nerg√©tique** : Integration de panneaux solaires et r√©cup√©ration d'eau de pluie
- **M√©thodes de construction modulaire** : R√©duction des d√©lais de construction de 25%

Cette r√©compense nous encourage √† poursuivre nos efforts d'innovation au service de nos clients et de l'environnement.
        `,
        coverImageUrl: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        tags: JSON.stringify(['Innovation', 'Prix', 'Durabilit√©', 'BTP']),
        publishedAt: new Date('2024-03-15'),
        published: true
      }
    }),
    prisma.article.create({
      data: {
        title: 'Nouveau partenariat avec l\'Universit√© Mohammed V',
        slug: 'partenariat-universite-mohammed-v',
        excerpt: 'NOBASUD s\'associe avec l\'universit√© pour d√©velopper les comp√©tences des futurs ing√©nieurs.',
        content: `
NOBASUD annonce la signature d'un partenariat strat√©gique avec l'√âcole Nationale Sup√©rieure d'Architecture de l'Universit√© Mohammed V de Rabat.

## Objectifs du partenariat

Ce partenariat vise √† :
- Former les futurs talents du BTP aux derni√®res technologies
- D√©velopper des projets de recherche appliqu√©e
- Offrir des stages et opportunit√©s d'emploi aux √©tudiants
- Cr√©er un laboratoire d'innovation partag√©

## Premiers projets

D√®s septembre 2024, nous accueillerons 15 stagiaires pour travailler sur nos projets d'envergure, notamment le d√©veloppement du nouveau quartier d'affaires de Casablanca.
        `,
        coverImageUrl: 'https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        tags: JSON.stringify(['Partenariat', 'Formation', 'Universit√©', 'Innovation']),
        publishedAt: new Date('2024-02-20'),
        published: true
      }
    }),
    prisma.article.create({
      data: {
        title: 'Lancement du projet √©co-quartier de Marrakech',
        slug: 'eco-quartier-marrakech',
        excerpt: 'Un nouveau projet ambitieux alliant tradition et modernit√© au c≈ìur de la ville rouge.',
        content: `
NOBASUD est fi√®re d'annoncer le lancement du projet d'√©co-quartier de Marrakech, un d√©veloppement urbain innovant de 50 hectares.

## Vision du projet

Ce quartier nouvelle g√©n√©ration int√©grera :
- **Architecture bioclimatique** respectant les codes traditionnels
- **Mobilit√© douce** avec pistes cyclables et transport √©lectrique
- **Gestion durable** de l'eau et des d√©chets
- **Espaces verts** repr√©sentant 40% de la superficie

## Planning

- Phase 1 (2024-2025) : Infrastructure et premiers logements
- Phase 2 (2025-2026) : Centre commercial et √©quipements publics
- Phase 3 (2026-2027) : Finalisation et espaces de loisirs

Livraison pr√©vue fin 2027 pour 2 000 nouveaux logements.
        `,
        coverImageUrl: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        tags: JSON.stringify(['√âco-quartier', 'Marrakech', 'D√©veloppement durable', 'Urbanisme']),
        publishedAt: new Date('2024-01-10'),
        published: true
      }
    })
  ])

  // Seed Jobs
  const jobs = await Promise.all([
    prisma.job.create({
      data: {
        title: 'Ing√©nieur Civil Senior',
        slug: 'ingenieur-civil-senior',
        department: 'Technique',
        location: 'Casablanca',
        description: `
## √Ä propos du poste

Nous recherchons un Ing√©nieur Civil Senior pour rejoindre notre √©quipe technique et superviser nos projets d'infrastructure majeurs.

## Responsabilit√©s

- Conception et supervision de projets de construction
- Management d'√©quipes techniques
- Suivi de la qualit√© et des d√©lais
- Interface avec les clients et partenaires

## Profil recherch√©

- Dipl√¥me d'ing√©nieur civil avec 5+ ans d'exp√©rience
- Ma√Ætrise des logiciels CAO/DAO
- Exp√©rience en management d'√©quipe
- Excellentes capacit√©s de communication

## Nous offrons

- Salaire comp√©titif selon exp√©rience
- Formation continue
- √âvolution de carri√®re
- Avantages sociaux complets
        `,
        published: true
      }
    }),
    prisma.job.create({
      data: {
        title: 'Chef de Projet BTP',
        slug: 'chef-de-projet-btp',
        department: 'Gestion de Projet',
        location: 'Marrakech',
        description: `
## Mission

Planifier, organiser et superviser l'ex√©cution de projets de construction de A √† Z.

## Comp√©tences requises

- Formation sup√©rieure en BTP ou √©quivalent
- 3-5 ans d'exp√©rience en gestion de projet
- Ma√Ætrise des outils de planification (MS Project, Primavera)
- Leadership et esprit d'√©quipe

## Avantages

- Package salarial attractif
- V√©hicule de fonction
- Participation aux b√©n√©fices
- Plan de formation personnalis√©
        `,
        published: true
      }
    }),
    prisma.job.create({
      data: {
        title: 'Architecte d\'Int√©rieur',
        slug: 'architecte-interieur',
        department: 'Design',
        location: 'Agadir',
        description: `
## Votre r√¥le

Concevoir et r√©aliser l'am√©nagement int√©rieur de nos projets r√©sidentiels et commerciaux haut de gamme.

## Profil id√©al

- Dipl√¥me en architecture d'int√©rieur
- Portfolio cr√©atif et innovant
- Ma√Ætrise des logiciels 3D (3ds Max, SketchUp, V-Ray)
- Sens artistique d√©velopp√©

## Ce que nous proposons

- Projets vari√©s et stimulants
- Environnement cr√©atif
- R√©mun√©ration selon profil
- Possibilit√© de t√©l√©travail partiel
        `,
        published: true
      }
    })
  ])

  // Seed sample feedback testimonials
  const feedbacks = await Promise.all([
    prisma.feedback.create({
      data: {
        name: 'Amina Benjelloun',
        email: 'amina.b@email.com',
        company: 'Soci√©t√© Immobili√®re Atlas',
        project: 'R√©sidence Al Manar',
        rating: 5,
        message: 'Je tiens √† f√©liciter l\'√©quipe NOBASUD pour la qualit√© exceptionnelle de la r√©sidence Al Manar. Les finitions sont parfaites et les espaces verts magnifiquement am√©nag√©s. Une √©quipe professionnelle et √† l\'√©coute.',
        published: true
      }
    }),
    prisma.feedback.create({
      data: {
        name: 'Hassan Alami',
        email: 'h.alami@email.com',
        company: 'Entreprise Alami & Fils',
        project: 'Centre Commercial Atlas',
        rating: 5,
        message: 'Le nouveau centre commercial est une r√©ussite ! Architecture moderne, espaces fonctionnels et parking pratique. Les d√©lais ont √©t√© respect√©s et la qualit√© est au rendez-vous. Bravo √† toute l\'√©quipe.',
        published: true
      }
    }),
    prisma.feedback.create({
      data: {
        name: 'Mohamed Fassi',
        email: 'm.fassi@email.com',
        company: 'Cabinet d\'Architecture Fassi',
        project: 'Boulevard Mohammed VI',
        rating: 4,
        message: 'Excellent travail sur le r√©am√©nagement du Boulevard Mohammed VI. L\'√©quipe a su minimiser les nuisances pour les riverains tout en respectant les d√©lais. Tr√®s professionnel.',
        published: true
      }
    }),
    prisma.feedback.create({
      data: {
        name: 'Fatima Zahra Bennani',
        email: 'fz.bennani@email.com',
        project: 'Quartier R√©sidentiel Anfa',
        rating: 5,
        message: 'Nous avons fait appel √† NOBASUD pour notre projet r√©sidentiel et nous ne regrettons pas ce choix. √âquipe comp√©tente, suivi rigoureux, et r√©sultat final exceptionnel. Je recommande vivement.',
        published: true
      }
    }),
    prisma.feedback.create({
      data: {
        name: 'Rachid Tounsi',
        email: 'r.tounsi@email.com',
        company: 'Groupe Tounsi Development',
        project: 'Pont Hassan II',
        rating: 4,
        message: 'Projet complexe men√© avec succ√®s. L\'expertise technique de NOBASUD est remarquable. Quelques ajustements en cours de route mais r√©sultat final tr√®s satisfaisant.',
        published: true
      }
    }),
    prisma.feedback.create({
      data: {
        name: 'Aicha El Mansouri',
        email: 'a.elmansouri@email.com',
        project: 'Villa individuelle',
        rating: 5,
        message: 'Construction de notre villa de r√™ve ! NOBASUD a su comprendre nos attentes et les concr√©tiser. Suivi personnalis√©, conseils avis√©s, et finitions impeccables.',
        published: false // En attente de validation
      }
    })
  ])

  // Seed sample applications
  const applications = await Promise.all([
    prisma.application.create({
      data: {
        name: 'Youssef Rachidi',
        email: 'y.rachidi@email.com',
        cvUrl: '/uploads/cv-youssef-rachidi.pdf',
        coverLetterUrl: '/uploads/lettre-motivation-youssef.pdf',
        message: 'Ing√©nieur civil avec 3 ans d\'exp√©rience, passionn√© par les projets d\'infrastructure. Je souhaite rejoindre NOBASUD pour contribuer √† vos projets innovants.',
      }
    }),
    prisma.application.create({
      data: {
        name: 'Fatima Zahra Bennani',
        email: 'fz.bennani@email.com',
        cvUrl: '/uploads/cv-fatima-bennani.pdf',
        message: 'Architecte fra√Æchement dipl√¥m√©e, cr√©ative et motiv√©e. J\'aimerais mettre mes comp√©tences au service de vos projets r√©sidentiels.',
      }
    })
  ])

  // Seed sample contact messages
  const contacts = await Promise.all([
    prisma.contactMessage.create({
      data: {
        name: 'Ahmed Tazi',
        email: 'ahmed.tazi@entreprise.ma',
        message: 'Bonjour, nous sommes int√©ress√©s par vos services pour la construction d\'un complexe industriel √† Tanger. Pouvez-vous nous envoyer une proposition ?',
      }
    }),
    prisma.contactMessage.create({
      data: {
        name: 'Soci√©t√© Immobili√®re Atlas',
        email: 'contact@atlas-immo.ma',
        message: 'Nous recherchons un partenaire BTP fiable pour le d√©veloppement d\'un projet r√©sidentiel de 200 logements. Merci de nous contacter.',
      }
    })
  ])

  console.log('‚úÖ Database seeded successfully!')
  console.log(`üìä Created:
  - 1 admin user
  - ${projects.length} projects
  - ${articles.length} articles  
  - ${jobs.length} jobs
  - ${feedbacks.length} feedbacks
  - ${applications.length} applications
  - 2 contact messages`)
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })